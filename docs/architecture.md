# Архитектура

## Общая структура системы
    
![](./architecture.png)


## Компоненты

### Работа системы и UI

При запуске программы, последовательно происходит следующее:
1. В консоль выводится приглашение (prompt)
2. Ожидается ввод пользователем команды
3. Введенная строка передается в работу интерпретатору и парсеру
4. В зависимости от результата работы выводится: результат или ошибка - с последующим возвратом к первому шагу, или происходит выход из программы

Если в качестве аргумента передается путь к скрипту, запускается аналогичный цикл, в котором вместо пунктов 1 и 2 интерпретатору с парсером передаются строки из этого скрипта.
    
### Парсер

Конструирует команду, которую нужно выполнить. Распознает специальные символы `$`, `'`, `"`, `|`, `=` и, исходя из них предписывает интерпретатору сделать одно из двух:
+ Осуществить подстановку и передать строчку на перепарсинг
+ Выполнить команду

### Окружение

Окружение - это словарь переменная-значение. При запуске приложения пустое окружение инициализируется и заполняется. При выходе из сессии окружение удаляется.

### Интерпретатор

Интерпретатор либо исполняет команду подстановки, либо используя `CommandResolver` исполняет другую команду.

### Команды

При исполнении команд используется `CommandResolver`. Ему известен некоторый набор стандартных команд.
Если переданной команды нет в наборе, то она исполняется как вызов внешней программы по её адресу в системе. 

Команде можно настроить её потоки ввода, вывода и ошибок.

### Подстановки

Подстановка ($) - команда, производящая подстановку, учитывая weak и strong quoting.

### Пайпы

Пайп - команда, которая принимает две команды в качестве аргументов, передавая каждому по копии окружения. Выполняет первую из команд и передаёт её вывод в поток ввода второй. Поток вывода ошибок у команд общий.

### Ошибки

Если происходит ошибка парсинга, то программа выводит об этом сообщение и возвращается к изначальному состоянию. В остальных случаях происходит вывод стандартного потока ошибок.

